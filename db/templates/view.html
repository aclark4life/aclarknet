{% extends 'dashboard/index.html' %}
{% block dashboard_title %}
  {% include 'title_block.html' %}
{% endblock %}
{% block dashhead_title %}
  <h2 class="dashhead-title">
    <a class="text-decoration-none text-secondary"
       href="{% url model_name|add:'_index' %}">{{ model_name_plural|title }}</a>
    <i class="fa-solid fa-angle-right"></i> {{ model_name|title }}
  </h2>
{% endblock %}
{% block dashboard %}
  {% include 'toolbars/index.html' %}
  {% if model_name == 'invoice' %}
    {% include 'accordion.html' %}
  {% endif %}
  {% load babel humanize tz text_filters %}
  <div class="accordion my-3" id="accordionDetail">
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="list-group-item list-group-item-action justify-content-between d-flex fw-semibold p-3 accordion-button"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapseDetail"
                aria-expanded="true"
                aria-controls="collapseDetail">Detail</button>
      </h2>
      <div id="collapseDetail"
           class="accordion-collapse show"
           data-bs-parent="#accordionDetail">
        <div class="accordion-body p-0">
          <table class="table table-striped my-0">
            <tbody>
              {% for field_name, field_value in field_values %}
                <tr>
                  <th>{{ field_name|title_case }}</th>
                  <td>
                    {% include 'field_value.html' %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {% if object_notes or user.is_superuser %}
    <div class="accordion my-3" id="accordionNotes">
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="list-group-item list-group-item-action justify-content-between d-flex fw-semibold p-3 accordion-button"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapseNotes"
                  aria-expanded="true"
                  aria-controls="collapseNotes">
            Notes ({{ object_notes|length|default:"0" }})
          </button>
        </h2>
        <div id="collapseNotes"
             class="accordion-collapse show"
             data-bs-parent="#accordionNotes">
          <div class="accordion-body">
            {% if user.is_superuser %}
              <div class="mb-3">
                <a href="{% url 'note_add_to_object' %}?content_type={{ content_type.id }}&object_id={{ object.pk }}"
                   class="btn btn-primary btn-sm">
                  <i class="fa-solid fa-plus"></i> Add Note
                </a>
              </div>
            {% endif %}
            {% if object_notes %}
              {% for note in object_notes %}
                <div class="card mb-3">
                  <div class="card-body">
                    {% if note.name %}
                      <h5 class="card-title">{{ note.name }}</h5>
                    {% endif %}
                    <p class="card-text">{{ note.text|linebreaks }}</p>
                    <div class="text-muted small">
                      {% if note.user %}
                        <i class="fa-solid fa-user"></i> {{ note.user.username }} â€¢
                      {% endif %}
                      <i class="fa-solid fa-clock"></i> {{ note.created|date:"SHORT_DATETIME_FORMAT" }}
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <p class="text-muted">No notes yet. Click "Add Note" to create one.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  {% if model_name == 'invoice' and user_calculations %}
    {% include 'user.html' %}
  {% endif %}
  {% if has_related and user.is_superuser %}
    {% include 'related.html' %}
  {% endif %}
{% endblock %}
