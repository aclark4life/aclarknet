{% extends 'base.html' %}
{% load humanize %}

{% block title %}Pay Invoice - ACLARK.NET{% endblock %}

{% block content %}
  <div class="container my-5 py-4">
    {% if STRIPE_TEST_MODE %}
      <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-flask"></i>
        <strong>Test Mode:</strong> This payment system is in test mode. Use test card number
        <code>4242 4242 4242 4242</code> with any future expiry date and any 3-digit CVC.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endif %}
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
              <i class="fa-solid fa-file-invoice-dollar"></i> Invoice Payment
              {% if STRIPE_TEST_MODE %}
                <span class="badge bg-warning text-dark ms-2">TEST MODE</span>
              {% endif %}
            </h4>
          </div>
          <div class="card-body">
            {% if invoice %}
              <div class="mb-4">
                <h5>Invoice Details</h5>
                <table class="table table-bordered">
                  <tbody>
                    <tr>
                      <th style="width: 30%;">Invoice Number</th>
                      <td>{{ invoice.invoice_number }}</td>
                    </tr>
                    {% if invoice.name %}
                      <tr>
                        <th>Description</th>
                        <td>{{ invoice.name }}</td>
                      </tr>
                    {% endif %}
                    {% if invoice.issue_date %}
                      <tr>
                        <th>Issue Date</th>
                        <td>{{ invoice.issue_date }}</td>
                      </tr>
                    {% endif %}
                    <tr>
                      <th>Total Amount</th>
                      <td>${{ invoice.amount|floatformat:2|intcomma }}</td>
                    </tr>
                    {% if invoice.paid_amount %}
                      <tr>
                        <th>Paid Amount</th>
                        <td>${{ invoice.paid_amount|floatformat:2|intcomma }}</td>
                      </tr>
                    {% endif %}
                    <tr>
                      <th>Balance Due</th>
                      <td class="fw-bold text-danger">${{ invoice.balance|floatformat:2|intcomma }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              {% if invoice.balance > 0 %}
                <div class="alert alert-info">
                  <i class="fa-solid fa-info-circle"></i>
                  <strong>Ready to pay?</strong> Click the button below to proceed with secure payment via Stripe.
                </div>

                <form method="post" action="{% url 'create_checkout_session' invoice.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-primary btn-lg w-100">
                    <i class="fa-brands fa-stripe"></i> Pay ${{ invoice.balance|floatformat:2|intcomma }} with Stripe
                  </button>
                </form>

                <div class="mt-3 text-center">
                  <small class="text-muted">
                    <i class="fa-solid fa-lock"></i> Secure payment powered by Stripe
                  </small>
                </div>
              {% else %}
                <div class="alert alert-success">
                  <i class="fa-solid fa-check-circle"></i>
                  <strong>Paid in Full</strong> - This invoice has been paid. Thank you!
                </div>
              {% endif %}
            {% else %}
              <div class="alert alert-danger">
                <i class="fa-solid fa-exclamation-triangle"></i>
                <strong>Invoice Not Found</strong> - The requested invoice could not be found.
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
